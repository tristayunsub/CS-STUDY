인터넷 공유기란?

L2스위치 내장. PC라던가 이런걸 유선연결 가능.

ROUTER하고 합쳐가지고. 주소를 두개쓴다. 인터넷이라고하는 PUBLIC IP GLOBAL IP주소.


IP주소를 공유해서 여러 HOST가 사용하게함.  NETWORK ADDRESS TRANSLATION IP주소 변환 ? 변조하고 조작하곤 뭐가 다른가?


PRIVATE IP 주소. TCP/IP 기반으로 통신한다. IP주소가 L3인데 L3 LAYER에서 작동하는데

PC가 인터넷을 쓴다고 가정

BROWSER 떴는데. 주소창에다 WWW.NAVER.COM 치면 그 주소 알아내서 접속

PACKET 형태로 트래픽이 PC에서 바깥으로 나감.

GATEWAY 도착해서 게이트웨이 역할 수행하는 공유기가. 공유기 안쪾 내부, 외부 인터넷

OUTBOUND 트래픽이 바깥으로 나갈때 이때 공유기 내부에는 자료구조

"" NAT TABLE"" 여기에 뭐가 들어가느냐

FIELD가 들어가는데 아웃 바운드 기준으로 공유기가 패킷 조사.


LOCAL IP 가 뭐지? 192.168.0.10. remote IP주소가 뭐냐~ 5.5.5.5 HTTP 접속했으면


포트번호가 80. 

기록 남기는데 새로운 포트번호를 만들어낸다. 최초의 PACKET

IP TCP PAYLOAD

SRC 192.168.0.10  3000
DST 5. 5. 5. 5    80

게이트웨이에서 B로나갈때 변조가 일어남.

인터넷을 쓸수있는 글로벌 주소로. 3.3.3.3으로

그때 포트번호도 바꿈. 2만번으로 포트번호 바꾸면. 3천번이아니라 2만번으로 

네이버가 C인데 패킷이 도착하면 

IP주소보니까 출발지가 3.3.3.3에 2만번이 5.5.5.5에 80번으로 접속

네이버는 착각하게됌 나는 TCP연결됬다고 생각함 3.3.3.3번은 PC가아니라 공유기임


네이버는 라우터랑 연결됬다고 착각함. 

패킷이 왔으니까 PC에게 정보 보내기 위해 네이버에서는 응답패킷 갈때 

IP TCP PAYLOAD

SRC 5. 5. 5. 5 80
DST 3. 3. 3. 3 2000

응답 패킷이~  외부에서 인바운드. 패킷을 뒤져서

SRC가 REMOTE가 되고~ 


NAT를 아느냐 모르느냐 매우 중요.

자동으로 F/W 기능도 들어감

예를 들어 3.3.3.3한테 접속하려할때 PACKET이 IP헤더만 보면

웹서버가있나~? DST IP가 3.3.3.3 80번에 접속하려함.
GATEWAY 공유기가 내꺼라고 가져가서 조사함

NAT TABLE에서 없는 PACKET이 들어오면 내부에 보내주질못하니까 자동으로 버린다.

완벽하게 패킷필터링 해버린다.


웜바이러스라는걸 슬슬 안쓰기시작함.

대신 랜섬웨어.

로드밸런서
===

![스크린샷(480)](https://user-images.githubusercontent.com/75001605/163846347-e7151652-d51a-4c35-bba0-a74969a0ac16.png)


https://www.stevenjlee.net/2020/06/30/%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC%EC%9D%98-%EB%B6%80%ED%95%98%EB%B6%84%EC%82%B0-%EB%A1%9C%EB%93%9C%EB%B0%B8%EB%9F%B0%EC%8B%B1-load-balancing-%EA%B7%B8/

공유기 뒤집으면 로드밸런싱


PC1,PC2,P3 - INTERNET - R - LB - WEB1,WEB2,WEB3.

Remote 정보, local ip주소, 등등이 중요하다.

여기서도 포트가 중요해지는데

80번이라고 특정해보자. 규칙이 중요 remote ip주소는 뭐가되도 좋음 any

local에선 웹서버가 여러개가있는데 192.168.0.10 썼는데

자기는 웹서버가아니니 주소변환. 목적지를 192.168로 보냄

매번 1번한테만 패킷을보내주는게 아니라. round robin이라고. 이번에는 영희는 2번한테 길동이한텐 3번에

공정 분배. 이게 라운드로빈인데 제일 무식한 방식. 

헬스 체크. cpu, 네트워크, 램사용량 조사.  

로드밸런서는 죽지만 않으면.. 부하분산을 L4 스위치로 구현 많이한다.

본격적으로 제대로하는거 하려면 
이 웹서버가 많아도. 로드밸런서 다운되면 끝나죠

이걸 두대를 설치함. 하나는 ACTIVE, 하나는 STAND BY . 이중화

L4 스위치!


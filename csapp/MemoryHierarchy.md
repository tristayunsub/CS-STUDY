메모리에도 계층이 존재한다.
cpu

level1

level2 

leve 3 등등 위로 올라수록 increasing speed and bandwidth
leveln 내려갈 수록 decreasing cost

DRAM은 비트당 가격이 저렴하지만 접근속도가 매우 느리고, SRAM은 비트당 가격이 비싸지면 접근속도가 매우 빠르다.

지역성을 잘 활용하면, DRAM과 SRAM을 동시에 사용하여 비트당 가격은 DRAM만큼 저렴하고, 접근속도는

SRAM만큼 빠른 메모리 소자가 있는듯한 효과를 만들어낸다.

접근속도가 빠르지만 비싼메모리는 CPU와 가까이. 접근속도는 느리지만 저렴하고 큰용량은 CPU와 먼 계층에.



![다운로드](https://user-images.githubusercontent.com/75001605/164998693-69c8eb1a-0646-4f86-b285-0b3c6aa7de4b.png)


REGISTER, L1 CACEH, L2CACHE, L3 : MAIN MEMORY DRAM, L4:LOCAL SECONDARY STORAGE. REMOTE~


3.RANDOM ACCESS MEMORY 설명. 각 셀은 1비트를 저장. 여러 셀이 모여 하나의 칩을이루고 그 칩이 쌓여 RAM

3-1.DYNAMIC RAM은 셀은 하나의 축전기 사용. 접근시에 는 하나의 트랜지스터가 사용

SRAM에 비해서 비트당 각격 저렴. 오래두면 휘발될수있기에 10~100MS 간격으로 게속 REFRESH 작업. 수행


3-2.SRAM은 각 셀이 무려 ***4~6개의 트랜지스터를 사용*** 따라서 DRAM에 비해 비트당 가격이 비쌈. 전력이 계속 공급되는한 휘발되지않고 안전하게 

저장되는값이 유지된다.일바적으로 SRAM을통해 캐시메모리



DRAM의 구조와 인터페이스

128바이트 DRAM
메모리 주소 7비트
상위 4비트: ROW,COL로 변환
하위 3비트: 슈퍼셀 오프셋


![다운로드 (1)](https://user-images.githubusercontent.com/75001605/164999386-f041ba09-1a4f-4dae-b6c8-ca8e161b1db5.png)


CPU가 접근하고자하는 메모리의 물리주소를 메모리 컨트롤러에 ㅣㅇㅂ력하면, 메모리 컨트롤러는 하위 3비트를 제외한 나머지 비트를 ROW,COL로 변환

이는 각 DRAM 칩에서 어떤 행과 어떤 열에 위치한 슈퍼셀을 고를것인지 나타내는 것이다. 그렇게 변환한 후에는 우선 ROW 정보를 바탕으로 각 DRAM 칩에서

행을 하나씩 골라 해당 칩의 내부행 버퍼로 가져온다.

ROW 정보를 바탕으로 DRAM칩에서 행을 하나씩 골라서칩의 내부행 버퍼로 가져옴.

그리고 COL정보 바타으로 내부행에 알맞는 슈퍼셀 골ㄹ라서, 메모리컨트롤러로 가져옴. 메모리컨트롤러에는 8바이트 크기의 데이터를 들여오게 됨.

CPU가 입력한 메모리 주소의 하위 3비트 정보를 바탕으로 몇번째 바이트부터 읽을 것인지 결정하고, 그곳에서부터 몇 바이트를 읽어야 하는지를 나타내는

제어 신호의 정보를 바탕으로 몇바이트 만큼 읽을지 결정한다.

모든 데이터가 메모리상에 ㅓㅈㅇ렬원칙에 따라 배치되어있다면. 적은횟수 참조만으로도 메모리의 데이터를 효율적으로 가져올수있따느것.

3-3 CPU와 메모리의 통신구조 인터페이스
=

![다운로드 (2)](https://user-images.githubusercontent.com/75001605/164999522-79aa5530-d661-4af2-af6d-e3a0fadfaf8a.png)

버스란 간단히 말해서 주소, 데이터컨트롤러 신호등을 운반하는 도선을 의미. 버스를 통해서 한번에 해당 CPU의 워드 사이즈만큼 데이터 교환 가능.

64비트 CPU의 버스는 64개의 도선이 하나의 버스를 이룬다. 물론 버스는 데이터의 교환을 위한 수단이기 때문에, 여러 장치가 공유하여 사용 가능하다.

메모리의 값을 읽을때. movq A, %eax 명령어를 실행한다고 해보자. CPU가 메모리 A를 시스템버스에 올려서 메모리 버스로 전달. 메인메모리가 메모리버스에서 A를 읽고

그 주소에 위치한 값을 로드하여 다시 메모리버스에 올리고. CPU가 다시 버스에서 X를 읽어서 %eax 에 복사하면 명령어 실행이 마무리된다.



ssd와 하드디스크의 성능
위 그림에서 볼 수 있듯이, 일반적인 메모리 소자와 유사하게 읽기/쓰기 작업의 경우

Random Access보다는 Sequential Access가 좋은 성능을 보인다. 특히, 쓰기 작업의 경우 SSD의 특성상 Random Access는 성능이 많이 떨어진다. 

한 블록을 지우는 작업이 적지 않은 시간을 필요로 하는데, 한 페이지를 수정하려면 그 페이지가 속한 블록의 다른 페이지들을 전부 삭제해야 하기 때문이다.

지금은 그래도 괜찮은 편이지만, 초창기 SSD는 이러한 이유 때문에 읽기 작업과 쓰기 작업의 성능 격차가 상당히 컸다.


하드 디스크와는 달리 물리적인 움직임을 필요로 하는 부분이 없기 때문에, 처리 속도가 더 빠르고 전력 소모가 적으며 무엇보다 외부의 충격에 대해 더욱 안전하다. 

하지만 앞서 언급했듯, 유한한 횟수의 쓰기 작업을 하고 나면 해당 블록의 수명이 다 하는 문제가 있다.

이러한 문제는 Flash Translation Layer에 특별한 로직을 추가함으로써 어느 정도 완화가 가능하다. 실제 사례로

, 인텔이 출시한 SSD 730은 그러한 로직을 추가함으로써 닳기 전까지 무려 128PB만큼의 데이터를 쓸 수 있도록 하였다. 최근 SSD는 MP3 플레이어, 스마트폰, 노트북 등에 주기억 장치로

서 많이 사용되고 있으며, 데스크탑과 서버에도 사용되는 사례가 계속해서 증가하는 추세이다. 점점 더 많은 부분에서 하드 디스크를 대체하고 있다.



5.지역성 
CPU 발전속도는 매우 빨라지고있는데 DRAM은 매우 느림. 메모리 계층은 이러한 문제를 해결하기위해나옴

그러나 중간에 SRAM 둔다고해서 이게 완전히 해결되는게아님. 그래서 지역성이라는 아이디어가 필요하다.

5-2 지역성의 개념

지역성이란 프로그램이 시간적 혹은 공간적으로 가까운 데이터 명령어를 다시 참조할 가능성이 높은 현상을 가리킴

첫번쨰는 시간적 지역성 Temporal locality, 두번째(spatial locality) 어떤 데이터를 참조하면 그 가까운 미래에 그 주변의 데이터를 참조할 확률이 높다

sum = 0;
for ( i = 0; i < n; i++)
  sum += a[i];
return sum;

i와 sum은 루프마다 계속해서 참조가된다. 시간적 지역성을 만족, 다음으로 배열a의 각 요소는 루프에 따라 순서대로 참조가 이뤄지기떄문에

공간적 지역성을 만족.

RAM으로 DRAM을 완전히 대체하기에는 SRAM의 비트 당 가격이 너무 비쌌다. 이때, 많은 프로그램들의 코드들을 살펴본 결과 지역성(Locality)이라는 
패턴이 존재한다는 것을 알게 되었다. 이러한 아이디어를 바탕으로 새로 고안된 SRAM 기반의 메모리가 바로 캐시 메모리(Cache Memory)이다. 
캐시 메모리는 CPU와 DRAM 사이에 위치하여 메모리 참조의 성능을 혁신적으로 향상시켰으며, 
CPU와 DRAM만 존재하는 단순한 메모리 구조를 혁파하고 오늘날과 같은 메모리 계층(Memory Hierarchy)을 확립하였다.


캐시 메모리는 dram에서 참조되는 부분을 가져와 저장하게되는데 이때 참조한 데이터만 캐시 메모리로 가져오는게 아니라 블록단위로 그주변의 데이터까지

한번에 캐시 메모리로 가져옴으로써, 공간적 지역성을 활용한다. 또한 그렇게 가져온 블록들을 최근에 참조한 순서대로 저장. 캐시 메모리가 꽉차는 경우에

가장 과거에 참조된 블록을 빼내는 방식을 취해 시간적 지역성을 활용

6.캐시 메모리
=

6-1. 개념

캐시란? 크고 느린 저장 장치가 가지고있는 데이터들중 접근 빈도가 높은 데이터들 일부를 저장하고 있는 작고 빠른 저장 장치를 의미.

캐시 메모리는 dram과 sram으로 이뤄지는 메모리 기술에 두 종류의 지역성ㅇ을 결합시킨 산물.


캐시 메모리의 핵심 아이디어는 메모리 기술에 대한 가상화(Virtualization)이다. 

즉, 가격은 DRAM만큼 저렴하지만 접근 속도는 SRAM만큼 빠른 메모리 장치를 사용하는 듯한 착각을 만들어 내는 것


![다운로드 (3)](https://user-images.githubusercontent.com/75001605/165000206-7354e481-660a-469b-8250-b8086a129008.png)


캐시는 dram에서 자주 사용되는 BLOCK들을 저장. CPU는 메모리 참조가 필요할때 캐시메모리확인하고 있으면 히트 없으면 미스라고함
